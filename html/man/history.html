
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The History class &#8212; TrueSkillThroughTime 0.0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Real examples" href="examples.html" />
    <link rel="prev" title="The Game class" href="game.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-history-class">
<h1>The <cite>History</cite> class<a class="headerlink" href="#the-history-class" title="Permalink to this headline">¶</a></h1>
<p>We use the <cite>History</cite> class to compute the learning curves and predictions of a sequence of events.</p>
<dl class="py class">
<dt class="sig sig-object py" id="trueskillthroughtime.History">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">trueskillthroughtime.</span></span><span class="sig-name descname"><span class="pre">History</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">composition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">times</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_draw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/trueskillthroughtime.html#History"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#trueskillthroughtime.History" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Let us return to the example seen on the first page of this manual.
We define the composition of each game using the names of the agents (i.e. their identifiers).
In the following example, all agents (<code class="code docutils literal notranslate"><span class="pre">&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;</span></code>) win one game and lose the other.
The results will be implicitly defined by the order in which the game compositions are initialized: the teams appearing firstly in the list defeat those appearing later.
By initializing <code class="code docutils literal notranslate"><span class="pre">gamma</span> <span class="pre">=</span> <span class="pre">0.0</span></code> we specify that skills do not change over time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">],[</span><span class="s2">&quot;b&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c2</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;b&quot;</span><span class="p">],[</span><span class="s2">&quot;c&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c3</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;c&quot;</span><span class="p">],[</span><span class="s2">&quot;a&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">composition</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">ttt</span><span class="o">.</span><span class="n">History</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="go">History(Events=3, Batches=3, Agents=3)</span>
</pre></div>
</div>
<p>After initialization, the <code class="code docutils literal notranslate"><span class="pre">History</span></code> class immediately instantiates a new player for each name and activates the computation of the TrueSkill estimates (not yet TrueSkill Through Time).</p>
<div class="section" id="learning-curves">
<h2>Learning curves<a class="headerlink" href="#learning-curves" title="Permalink to this headline">¶</a></h2>
<p>To access estimates we can call the method <code class="code docutils literal notranslate"><span class="pre">learning_curves()</span></code>, which returns a dictionary indexed by the names of the agents.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">()[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="go">[(1, N(mu=3.339, sigma=4.985)), (3, N(mu=-2.688, sigma=3.779))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">()[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="go">[(1, N(mu=-3.339, sigma=4.985)), (2, N(mu=0.059, sigma=4.218))]</span>
</pre></div>
</div>
<p>Individual learning curves are lists of tuples: each tuple has the time of the estimate as the first component and the estimate itself as the second one.
Although in this example no player is stronger than the others, the TrueSkill estimates present strong variations between players.</p>
</div>
<div class="section" id="convergence">
<h2>Convergence<a class="headerlink" href="#convergence" title="Permalink to this headline">¶</a></h2>
<p>TrueSkill Through Time solves TrueSkill’s inability to obtain correct estimates by allowing the information to propagate throughout the system.
To compute them, we call the method <code class="code docutils literal notranslate"><span class="pre">convergence()</span></code> of the <code class="code docutils literal notranslate"><span class="pre">History</span></code> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">convergence</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">()[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="go">[(1, N(mu=0.000, sigma=2.395)), (3, N(mu=-0.000, sigma=2.395))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">()[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="go">[(1, N(mu=-0.000, sigma=2.395)), (2, N(mu=-0.000, sigma=2.395))]</span>
</pre></div>
</div>
<p>TrueSkill Through Time not only returns correct estimates (same for all players), they also have less uncertainty.</p>
</div>
<div class="section" id="model-evidence">
<h2>Model evidence<a class="headerlink" href="#model-evidence" title="Permalink to this headline">¶</a></h2>
<p>We would like to have a procedure to decide whether TrueSkill Through Time is better than others models and the optimal values of the parameters <code class="code docutils literal notranslate"><span class="pre">\sigma</span></code> and <code class="code docutils literal notranslate"><span class="pre">\gamma</span></code>.
In the same way that we use probability theory to evaluate the hypotheses of a model given the data, we can also evaluate different models given the data.</p>
<p><span class="math notranslate nohighlight">\(P(\text{Model}|\text{Data}) \propto P(\text{Data}|\text{Model})P(\text{Model})\)</span></p>
<p>where <span class="math notranslate nohighlight">\(P(\text{Model})\)</span> is the prior of the models, which we define, and <span class="math notranslate nohighlight">\(P(\text{Data}|\text{Model})\)</span> is the prediction made by the model.
In the special case where we have no prior preference over any model, we need only compare the predictions made by the models.</p>
<p><span class="math notranslate nohighlight">\(P(\text{Model}|\text{Data}) \propto P(\text{Data}|\text{Model})\)</span></p>
<p>In other words, we prefer the model with the best prediction.</p>
<p><span class="math notranslate nohighlight">\(P(\text{Data}|\text{Model}) = P(d_1|\text{M})P(d_2|d_1,\text{M}) \dots P(d_n|d_{n-1}, \dots, d_1, \text{M})\)</span></p>
<p>where D represents the data set, M the model, and <span class="math notranslate nohighlight">\(d_i\)</span> the individual data points.
This measure can be obtained by the <code class="code docutils literal notranslate"><span class="pre">evidence</span></code> method.
Let us develop a complex synthetic example in which this measure is useful for choosing the optimal dynamic uncertainty.</p>
</div>
<div class="section" id="optimizing-the-dynamic-factor">
<h2>Optimizing the dynamic factor<a class="headerlink" href="#optimizing-the-dynamic-factor" title="Permalink to this headline">¶</a></h2>
<p>We now analyze a scenario in which a new player joins a large community of already known players.
In this example, we focus on the estimation of an evolving skill.
For this purpose, we establish the skill of the target player to change over time following a logistic function.
The community is generated by ensuring that each opponent has a skill similar to that of the target player throughout their evolution.
In the following code, we generate the target player’s learning curve and 1000 random opponents.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span><span class="p">;</span> <span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">normal</span><span class="p">,</span> <span class="n">seed</span><span class="p">;</span> <span class="n">seed</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">def</span> <span class="nf">skill</span><span class="p">(</span><span class="n">experience</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">slope</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">maximum</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">experience</span><span class="o">+</span><span class="n">middle</span><span class="p">)))</span>

<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="n">skill</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0075</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">opponents</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>The list <code class="code docutils literal notranslate"><span class="pre">target</span></code> has the agent’s skills at each moment: the values start at zero and grow smoothly until the target player’s skill reaches two.
The list <code class="code docutils literal notranslate"><span class="pre">opponents</span></code> includes the randomly generated opponents’ skills following a Gaussian distribution centered on each target’s skills and a standard deviation of 0.5.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">composition</span> <span class="o">=</span> <span class="p">[[[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">normal</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">normal</span><span class="p">(</span><span class="n">opponents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="n">priors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">ttt</span><span class="o">.</span><span class="n">Player</span><span class="p">(</span><span class="n">ttt</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">opponents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.2</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">ttt</span><span class="o">.</span><span class="n">History</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">priors</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.015</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">convergence</span><span class="p">()</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">tp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mu</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">()[</span><span class="s2">&quot;a&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<p>In this code, we define four variables to instantiate the class <cite>History</cite> to compute the target’s learning curve.
The variable <code class="code docutils literal notranslate"><span class="pre">composition</span></code> contains 1000 games between the target player and different opponents.
The list <code class="code docutils literal notranslate"><span class="pre">results</span></code> is generated randomly by sampling the agents’ performance following Gaussian distributions centered on their skills. The winner is the player with the highest performance.
The variable <code class="code docutils literal notranslate"><span class="pre">time</span></code> is a list of integer values ranging from 0 to 999 representing the time batch in which each game is located: the class <code class="code docutils literal notranslate"><span class="pre">History</span></code> uses the temporal distance between events to determine the amount of dynamic uncertainty (<span class="math notranslate nohighlight">\(\gamma^2\)</span>) to be added between games.
The variable <code class="code docutils literal notranslate"><span class="pre">priors</span></code> is a dictionary used to customize player attributes: we assign low uncertainty to the opponents’ priors as we know their skills beforehand.</p>
<p>The class <code class="code docutils literal notranslate"><span class="pre">History</span></code> receives these four parameters and initializes the target player using the default values and a dynamic uncertainty <code class="code docutils literal notranslate"><span class="pre">gamma=0.018</span></code>.
Using the method <code class="code docutils literal notranslate"><span class="pre">convergence()</span></code>, we obtain the TrueSkill Through Time estimates and the target’s learning curve.
The following figure shows the evolution of the true (solid line) and estimated (dotted line) target player’s learning curves.</p>
<img alt="../_images/logistic0.png" src="../_images/logistic0.png" />
<p>The estimated learning curves remain close to the actual skill during the whole evolution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">le</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">log_evidence</span><span class="p">()</span>
</pre></div>
</div>
<p>The geometric mean of the evidence is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">le</span><span class="o">/</span><span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="go">0.51802292530</span>
</pre></div>
</div>
<p>To optimize, repeat this procedure with different values of gamma until minimize the <code class="code docutils literal notranslate"><span class="pre">log_evidence</span></code> (or maximize the geommetric mean).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">TrueSkillThroughTime</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="causal.html">Causal model</a></li>
<li class="toctree-l1"><a class="reference internal" href="gaussian.html">The <cite>Gaussian</cite> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="player.html">The <cite>Player</cite> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="game.html">The <cite>Game</cite> class</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The <cite>History</cite> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Real examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="game.html" title="previous chapter">The <cite>Game</cite> class</a></li>
      <li>Next: <a href="examples.html" title="next chapter">Real examples</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Gustavo Landfried.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/man/history.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>